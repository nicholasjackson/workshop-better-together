# Step 2: Retreive AppRole credentials and configure AAP

Vault's [AppRole](https://www.vaultproject.io/docs/auth/approle) authentication (auth) method is used to enable AAP to authenticate with Vault using a Role ID and Secret ID.

The AppRole auth method has been preconfigured for each team in their respective namespaces, as such the Role ID and Secret ID are unique to each team and are stored in Vault. This task will guide you through retrieving the Role ID and Secret ID for use with AAP. 

## Retreive AppRole credentials for Ansible Automation Platform

<Task id="read_aap_creds">
1. Using the same terminal that you logged into Vault with in the prior tasks, retreive the Role ID using the command.
```
vault read -namespace=admin/&lt;your_team_name&gt; auth/approle/role/aap/role-id
```
Replace `<your_team_name>` with your team's name.

You should see the following output
```
# vault read -namespace=admin/testorga auth/approle/role/aap/role-id
Key        Value
---        -----
role_id    3d05b15f-4262-419a-c609-b3a2633877b4
```
2. Retreive the Secret ID using the command.
```
vault write -namespace=admin/&lt;your_team_name&gt; -force auth/approle/role/aap/secret-id
```
Replace `<your_team_name>` with your team's name.

You should see the following output
```
# vault write -namespace=admin/testorga -force auth/approle/role/aap/secret-id
Key                   Value
---                   -----
secret_id             950d8a35-5b34-228f-5475-030c6ecbf970
secret_id_accessor    7978c558-2d0c-5ab9-c178-89ee68bab69c
secret_id_num_uses    0
secret_id_ttl         0s
```
3. Make a note of the Role ID and Secret ID as you will need them in the next task.
</Task>
## Configure AAP Vault SSH credentials
<Task id="configure_aap_vault_creds">
1. From the Instruqt lab, click on the **Ansible Automation Platform** tab to open the Ansible Automation Platform web interface. (ignore any certificate warnings, this is lab environment)
2. Enter the username allocated to your team and the password provided. **Hint:** the details can be retrieved from Vault. The Vault path is `secrets/app`
![aaplogin](https://dl.dropbox.com/scl/fi/zcugwe69mivn3tu9pgngr/aap_login.png?rlkey=opnq7rvdpe9uirqgmv9hco0oc&st=c9bicjtq&dl=0)
3. From the left menu, click on **Automation Execution** and then **Credentials**. The `hashicorp_vault_ssh_approle` has been preconfigured but you'll need to input the AppRole Role ID and Secret ID to complete the configuration
![aaprolecreds](https://dl.dropbox.com/scl/fi/l652u0yqcsdiz06qs13k0/HashiStack-RHEL-Solutions-SKO_screenshots-1.png?rlkey=0f7xly71ad9yj7f131w5ykli6&st=o4rngbpi&dl=0)
4. Click on the edit credential icon for the **hashicorp_vault_ssh_approle** credential.
5. Enter the Role ID and Secret ID you retrieved in the previous task into the respective fields.
![aaproleconfigure](https://dl.dropbox.com/scl/fi/0ym73sc3pl1cyv61yprwi/approle_config.png?rlkey=se6q0v2v5lljfhjw5k7occr6x&st=qi4a4jdo&dl=0)
6. Click **Test** (Opens a new window with additional fields).
    * For `Unsigned Public Key`, insert a unsigned public key. You can use the key provided in the `secrets/aap` path in Vault or use your own if you are feeling adventurous.
    * For `Path to Secret`, insert `ssh`.
    * For `Path to Auth`, insert `approle`.
    * For `Role Name`, insert `aap`.
![aaproletest](https://dl.dropbox.com/scl/fi/0v9b9hd2qtxwly9h8fhgf/approle_test.png?rlkey=fxsmwm37vb52nns3vuv6pe98n&st=54jmari9&dl=0)
7. Click *Run* to test the connection.
![aaproletestpass](https://dl.dropbox.com/scl/fi/tr0hjml3wl1z27uzn6f9b/approle_testpassed.png?rlkey=xtuopomol6y9qgndrgpvpirp3&st=h4rvlwi9&dl=0)
8. If the test is successful, click **Save credential** to save the configuration.
</Task>